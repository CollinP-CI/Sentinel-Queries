{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "loganalyticsworkspace": {
      "defaultValue": "enduserspreprod-sentinel-loganalyticsworkspace",
      "type": "String"
    },
    "loganalyticsworkspace-location": {
      "defaultValue": "eastus",
      "type": "String"
    },
    "loganalyticsworkspace-subscription": {
      "defaultValue": "6a8cbfca-fb3f-42a3-bff4-2d7cfa2c422f",
      "type": "String"
    },
    "loganalyticsworkspace-resourceGroup": {
      "defaultValue": "sentineltesting_rg",
      "type": "String"
    },
    "flag-raw-copy-normdata": {
      "defaultValue": false,
      "allowedValues": [false, true],
      "type": "Bool"
    },
    "table-tier-for-raw-copy": {
      "defaultValue": "Basic",
      "allowedValues": ["Analytics", "Basic"],
      "type": "String"
    },
    "dce-reuse-flag": {
      "defaultValue": false,
      "allowedValues": [false, true],
      "type": "Bool",
      "metadata": {
        "description": "The default name for the DCE is ms-sentinel-dce-[function-name]-[LA-Region]. If you prefer a custom name, please set this flag to true"
      }
    },
    "input-dce-name": {
      "defaultValue": "Cribl-Stream-Ingestion",
      "type": "String"
    },
    "dcr-raw-data_refresh_flag": {
      "defaultValue": true,
      "type": "Bool"
    },
    "dcr-normalized-data_refresh_flag": {
      "defaultValue": true,
      "allowedValues": [false, true],
      "type": "Bool"
    },
    "dcr-raw-data_name_input": {
      "defaultValue": "crowdstrike-fdr-dcr-rawdata-us-east",
      "type": "String",
      "metadata": {
        "description": "Default name will be ms-sentinel-rawdata-dcr-[function-name]-[LA-Region], no need to enter if you want to use default names"
      }
    },
    "dcr-normalized-data_name_input": {
      "defaultValue": "crowdstrike-fdr-dcr-ncrowdstrike-fdr-dcr-rawdata-us-east-useast",
      "type": "String",
      "metadata": {
        "description": "Default name will be ms-sentinel-normdata-dcr-[function-name]-[LA-Region], no need to enter if you want to use default names"
      }
    },
    "function-name": {
      "defaultValue": "csfdr01",
      "type": "String"
    }
  },
  "variables": {
    "loganalyticsworkspace": "[parameters('loganalyticsworkspace')]",
    "loganalyticsworkspace-location": "[parameters('loganalyticsworkspace-location')]",
    "loganalyticsworkspace-subscription": "[parameters('loganalyticsworkspace-subscription')]",
    "loganalyticsworkspace-resourceGroup": "[parameters('loganalyticsworkspace-resourceGroup')]",
    "flag-raw-copy-normdata": "[parameters('flag-raw-copy-normdata')]",
    "table-tier-for-raw-copy": "[parameters('table-tier-for-raw-copy')]",
    "default-dce-name": "[concat('ms-sentinel-dce-',parameters('function-name'),'-',replace(variables('loganalyticsworkspace-location'),' ', ''))]",
    "dce-name": "[if(not(parameters('dce-reuse-flag')), variables('default-dce-name'), parameters('input-dce-name'))]",
    "dcr-raw-data": "[if(empty(parameters('dcr-raw-data_name_input')), concat('ms-sentinel-rawdata-dcr-',parameters('function-name'),'-',replace(variables('loganalyticsworkspace-location'),' ','')), parameters('dcr-raw-data_name_input'))]",
    "dcr-normalized-data": "[if(empty(parameters('dcr-normalized-data_name_input')), concat('ms-sentinel-normdata-dcr-',parameters('function-name'),'-',replace(variables('loganalyticsworkspace-location'),' ', '')), parameters('dcr-normalized-data_name_input'))]",
    "dcr-raw-data_refresh_flag": "[parameters('dcr-raw-data_refresh_flag')]",
    "dcr-normalized-data_refresh_flag": "[parameters('dcr-normalized-data_refresh_flag')]",
    "cust-table-csdns": "Custom-CrowdStrike_DNS_Events_CL",
    "cust-table-csfile": "Custom-CrowdStrike_File_Events_CL",
    "cust-table-csnetwork": "Custom-CrowdStrike_Network_Events_CL",
    "cust-table-csaudit": "Custom-CrowdStrike_Audit_Events_CL"
    "norm-table-csfile": "ASimFileEventLogs_CL",
    "norm-table-csprocess": "ASimProcessEventLogs_CL",
    "norm-table-csauth": "ASimAuthenticationEventLogs_CL",
    "norm-table-csregistry": "ASimRegistryEventLogs_CL",
    "norm-table-csusermgmt": "ASimUserManagementLogs_CL"
  },
            {
              "condition": "[variables('flag-raw-copy-normdata')]",
              "name": "[concat(variables('loganalyticsworkspace'),'/',variables('cust-table-csaudit'))]",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "apiVersion": "2022-10-01",
              "tags": {},
              "properties": {
                "plan": "Analytics",
                "schema": {
                  "name": "[variables('cust-table-csaudit')]",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "DateTime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                    },
                    {
                      "name": "event_simpleName",
                      "type": "string"
                    },
                    {
                      "name": "timestamp",
                      "type": "long"
                    },
                    {
                      "name": "aip",
                      "type": "string"
                    },
                    {
                      "name": "aid",
                      "type": "string"
                    },
                    {
                      "name": "UserName",
                      "type": "string"
                    },
                    {
                      "name": "event_platform",
                      "type": "string"
                    },
                    {
                      "name": "ContextTimeStamp",
                      "type": "real"
                    },
                    {
                      "name": "name",
                      "type": "string"
                    },
                    {
                      "name": "ConfigBuild",
                      "type": "string"
                    },
                    {
                      "name": "CrowdStrikeId",
                      "type": "string"
                    },
                    {
                      "name": "ConfigStateHash",
                      "type": "string"
                    },
                    {
                      "name": "ContextProcessId",
                      "type": "string"
                    },
                    {
                      "name": "ContextThreadId",
                      "type": "string"
                    },
                    {
                      "name": "BoundingLimitCount",
                      "type": "long"
                    },
                    {
                      "name": "BoundingLimitDuration",
                      "type": "string"
                    },
                    {
                      "name": "Entitlements",
                      "type": "string"
                    },
                    {
                      "name": "EffectiveTransmissionClass",
                      "type": "string"
                    },
                    {
                      "name": "cid",
                      "type": "string"
                    },
                    {
                      "name": "OciContainerId",
                      "type": "string"
                    },
                    {
                      "name": "TreeId",
                      "type": "string"
                    },
                    {
                      "name": "VolumeSnapshotName",
                      "type": "string"
                    },
                    {
                      "name": "SmbShareName",
                      "type": "string"
                    },
                    {
                      "name": "ShareName",
                      "type": "string"
                    },
                    {
                      "name": "UploadId",
                      "type": "string"
                    },
                    {
                      "name": "SessionId",
                      "type": "string"
                    },
                    {
                      "name": "ComputerName",
                      "type": "string"
                    },
                    {
                      "name": "FirewallRule",
                      "type": "string"
                    },
                    {
                      "name": "FirewallRuleId",
                      "type": "string"
                    },
                    {
                      "name": "FirewallOption",
                      "type": "string"
                    },
                    {
                      "name": "SourceFileName",
                      "type": "string"
                    },
                    {
                      "name": "TargetFileName",
                      "type": "string"
                    },
                    {
                      "name": "DeviceVendorId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceProductId",
                      "type": "string"
                    },
                    {
                      "name": "DeviceSerialNumber",
                      "type": "string"
                    },
                    {
                      "name": "BluetoothDeviceAddress",
                      "type": "string"
                    },
                    {
                      "name": "EnvironmentVariableName",
                      "type": "string"
                    },
                    {
                      "name": "SamAccountName",
                      "type": "string"
                    },
                    {
                      "name": "FirewallOptionNumericValue",
                      "type": "string"
                    },
                    {
                      "name": "FirewallOptionStringValue",
                      "type": "string"
                    },
                    {
                      "name": "FileVaultIsEnabled",
                      "type": "boolean"
                    },
                    {
                      "name": "EnvironmentVariableValue",
                      "type": "string"
                    },
                    {
                      "name": "ConfigStateData",
                      "type": "string"
                    },
                    {
                      "name": "ActiveDirectoryOuDn",
                      "type": "string"
                    },
                    {
                      "name": "ActiveDirectoryDepartment",
                      "type": "string"
                    },
                    {
                      "name": "SHA256HashData",
                      "type": "string"
                    },
                    {
                      "name": "CommandLine",
                      "type": "string"
                    },
                    {
                      "name": "VolumeName",
                      "type": "string"
                    },
                    {
                      "name": "VolumeDriveLetter",
                      "type": "string"
                    },
                    {
                      "name": "TokenType",
                      "type": "string"
                    },
                    {
                      "name": "InterfaceGuid",
                      "type": "string"
                    },
                    {
                      "name": "RpcClientProcessId",
                      "type": "string"
                    },
                    {
                      "name": "InterfaceVersion",
                      "type": "string"
                    },
                    {
                      "name": "RpcClientThreadId",
                      "type": "string"
                    },
                    {
                      "name": "AuthenticationId",
                      "type": "string"
                    },
                    {
                      "name": "ImageFileName",
                      "type": "string"
                    },
                    {
                      "name": "RpcOpNum",
                      "type": "string"
                    },
                    {
                      "name": "RpcNestingLevel",
                      "type": "string"
                    },
                    {
                      "name": "ClientComputerName",
                      "type": "string"
                    },
                    {
                      "name": "DomainName",
                      "type": "string"
                    },
                    {
                      "name": "RemoteAddressIP6",
                      "type": "string"
                    },
                    {
                      "name": "RemoteAddressIP4",
                      "type": "string"
                    },
                    {
                      "name": "SmbClientName",
                      "type": "string"
                    },
                    {
                      "name": "AgentLoadFlags",
                      "type": "string"
                    },
                    {
                      "name": "ProvisioningDuration",
                      "type": "string"
                    },
                    {
                      "name": "Status",
                      "type": "string"
                    },
                    {
                      "name": "ErrorText",
                      "type": "string"
                    },
                    {
                      "name": "CloudErrorCode",
                      "type": "string"
                    },
                    {
                      "name": "SharePath",
                      "type": "string"
                    },
                    {
                      "name": "ShareMaxCount",
                      "type": "long"
                    },
                    {
                      "name": "ShareRemark",
                      "type": "string"
                    },
                    {
                      "name": "ShareData",
                      "type": "string"
                    },
                    {
                      "name": "IntelTDTEnabled",
                      "type": "string"
                    },
                    {
                      "name": "FalconServiceState",
                      "type": "string"
                    },
                    {
                      "name": "LfoUploadFlags",
                      "type": "string"
                    },
                    {
                      "name": "AttemptNumber",
                      "type": "long"
                    },
                    {
                      "name": "Size",
                      "type": "string"
                    },
                    {
                      "name": "Tags",
                      "type": "string"
                    },
                    {
                      "name": "CloudRequestId",
                      "type": "string"
                    },
                    {
                      "name": "LocalSession",
                      "type": "string"
                    },
                    {
                      "name": "IOServiceClass",
                      "type": "string"
                    },
                    {
                      "name": "IOServicePath",
                      "type": "string"
                    },
                    {
                      "name": "IOServiceProperties",
                      "type": "string"
                    },
                    {
                      "name": "IOServiceName",
                      "type": "string"
                    },
                    {
                      "name": "Protocol",
                      "type": "string"
                    },
                    {
                      "name": "ChannelDiffStatusList",
                      "type": "string"
                    },
                    {
                      "name": "AccountDomain",
                      "type": "string"
                    },
                    {
                      "name": "AccountObjectGuid",
                      "type": "string"
                    },
                    {
                      "name": "AccountObjectSid",
                      "type": "string"
                    },
                    {
                      "name": "TotalCount",
                      "type": "long"
                    },
                    {
                      "name": "ErrorCode",
                      "type": "string"
                    },
                    {
                      "name": "EventOrigin",
                      "type": "string"
                    },
                    {
                      "name": "AddressFamily",
                      "type": "string"
                    },
                    {
                      "name": "BluetoothDeviceType",
                      "type": "string"
                    },
                    {
                      "name": "DeviceTimeStamp",
                      "type": "real"
                    },
                    {
                      "name": "DeviceInstanceId",
                      "type": "string"
                    },
                    {
                      "name": "BluetoothDeviceAddressType",
                      "type": "string"
                    },
                    {
                      "name": "DeviceVersion",
                      "type": "string"
                    },
                    {
                      "name": "DeviceDescriptorSetHash",
                      "type": "string"
                    },
                    {
                      "name": "DeviceManufacturer",
                      "type": "string"
                    },
                    {
                      "name": "DeviceProduct",
                      "type": "string"
                    },
                    {
                      "name": "DeviceUserSid",
                      "type": "string"
                    },
                    {
                      "name": "DeviceUserAuthenticationId",
                      "type": "string"
                    },
                    {
                      "name": "FirewallProfile",
                      "type": "string"
                    },
                    {
                      "name": "ShareAccess",
                      "type": "string"
                    },
                    {
                      "name": "DesiredAccess",
                      "type": "string"
                    },
                    {
                      "name": "GID",
                      "type": "string"
                    },
                    {
                      "name": "UID",
                      "type": "string"
                    },
                    {
                      "name": "UnixMode",
                      "type": "string"
                    },
                    {
                      "name": "AdditionalFields",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            },
            {
              "condition": "[variables('flag-raw-copy-normdata')]",
              "name": "[concat(variables('loganalyticsworkspace'),'/',variables('cust-table-csdns'))]",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "apiVersion": "2022-10-01",
              "tags": {},
              "properties": {
                "plan": "[variables('table-tier-for-raw-copy')]",
                "schema": {
                  "name": "[variables('cust-table-csdns')]",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "DateTime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                    },
                    {
                      "name": "event_simpleName",
                      "type": "string"
                    },
                    {
                      "name": "timestamp",
                      "type": "long"
                    },
                    {
                      "name": "aip",
                      "type": "string"
                    },
                    {
                      "name": "aid",
                      "type": "string"
                    },
                    {
                      "name": "UserName",
                      "type": "string"
                    },
                    {
                      "name": "event_platform",
                      "type": "string"
                    },
                    {
                      "name": "ContextTimeStamp",
                      "type": "real"
                    },
                    {
                      "name": "name",
                      "type": "string"
                    },
                    {
                      "name": "ConfigBuild",
                      "type": "string"
                    },
                    {
                      "name": "CrowdStrikeId",
                      "type": "string"
                    },
                    {
                      "name": "ConfigStateHash",
                      "type": "string"
                    },
                    {
                      "name": "ContextProcessId",
                      "type": "string"
                    },
                    {
                      "name": "ContextThreadId",
                      "type": "string"
                    },
                    {
                      "name": "BoundingLimitCount",
                      "type": "long"
                    },
                    {
                      "name": "BoundingLimitDuration",
                      "type": "string"
                    },
                    {
                      "name": "Entitlements",
                      "type": "string"
                    },
                    {
                      "name": "EffectiveTransmissionClass",
                      "type": "string"
                    },
                    {
                      "name": "cid",
                      "type": "string"
                    },
                    {
                      "name": "OciContainerId",
                      "type": "string"
                    },
                    {
                      "name": "TreeId",
                      "type": "string"
                    },
                    {
                      "name": "DomainName",
                      "type": "string"
                    },
                    {
                      "name": "RequestType",
                      "type": "string"
                    },
                    {
                      "name": "IP4Records",
                      "type": "string"
                    },
                    {
                      "name": "QueryStatus",
                      "type": "string"
                    },
                    {
                      "name": "FirstIP4Record",
                      "type": "string"
                    },
                    {
                      "name": "DnsRequestCount",
                      "type": "long"
                    },
                    {
                      "name": "IP6Records",
                      "type": "string"
                    },
                    {
                      "name": "InterfaceIndex",
                      "type": "long"
                    },
                    {
                      "name": "DualRequest",
                      "type": "string"
                    },
                    {
                      "name": "DnsResponseType",
                      "type": "string"
                    },
                    {
                      "name": "EventOrigin",
                      "type": "string"
                    },
                    {
                      "name": "RespondingDnsServer",
                      "type": "string"
                    },
                    {
                      "name": "CNAMERecords",
                      "type": "string"
                    },
                    {
                      "name": "FirstIP6Record",
                      "type": "string"
                    },
                    {
                      "name": "AdditionalFields",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            },
            {
              "condition": "[variables('flag-raw-copy-normdata')]",
              "name": "[concat(variables('loganalyticsworkspace'),'/',variables('cust-table-csfile'))]",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "apiVersion": "2022-10-01",
              "tags": {},
              "properties": {
                "plan": "[variables('table-tier-for-raw-copy')]",
                "schema": {
                  "name": "[variables('cust-table-csfile')]",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "DateTime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                    },
                    {
                      "name": "event_simpleName",
                      "type": "string"
                    },
                    {
                      "name": "timestamp",
                      "type": "long"
                    },
                    {
                      "name": "aip",
                      "type": "string"
                    },
                    {
                      "name": "aid",
                      "type": "string"
                    },
                    {
                      "name": "event_platform",
                      "type": "string"
                    },
                    {
                      "name": "ContextTimeStamp",
                      "type": "real"
                    },
                    {
                      "name": "name",
                      "type": "string"
                    },
                    {
                      "name": "ConfigBuild",
                      "type": "string"
                    },
                    {
                      "name": "ContextProcessId",
                      "type": "string"
                    },
                    {
                      "name": "CrowdStrikeId",
                      "type": "string"
                    },
                    {
                      "name": "UserName",
                      "type": "string"
                    },
                    {
                      "name": "TargetFileName",
                      "type": "string"
                    },
                    {
                      "name": "FileOperatorSid",
                      "type": "string"
                    },
                    {
                      "name": "Size",
                      "type": "long"
                    },
                    {
                      "name": "FileWrittenFlags",
                      "type": "string"
                    },
                    {
                      "name": "OperationFlags",
                      "type": "string"
                    },
                    {
                      "name": "SHA256HashData",
                      "type": "string"
                    },
                    {
                      "name": "SourceFileName",
                      "type": "string"
                    },
                    {
                      "name": "CommandLine",
                      "type": "string"
                    },
                    {
                      "name": "OriginalFilename",
                      "type": "string"
                    },
                    {
                      "name": "ClientId",
                      "type": "string"
                    },
                    {
                      "name": "TargetDirectoryName",
                      "type": "string"
                    },
                    {
                      "name": "UID",
                      "type": "string"
                    },
                    {
                      "name": "Status",
                      "type": "string"
                    },
                    {
                      "name": "ImageFileName",
                      "type": "string"
                    },
                    {
                      "name": "IsOnRemovableDisk",
                      "type": "string"
                    },
                    {
                      "name": "MinorFunction",
                      "type": "string"
                    },
                    {
                      "name": "IsOnNetwork",
                      "type": "string"
                    },
                    {
                      "name": "FileIdentifier",
                      "type": "string"
                    },
                    {
                      "name": "TokenType",
                      "type": "string"
                    },
                    {
                      "name": "DiskParentDeviceInstanceId",
                      "type": "string"
                    },
                    {
                      "name": "FileObject",
                      "type": "string"
                    },
                    {
                      "name": "IrpFlags",
                      "type": "string"
                    },
                    {
                      "name": "AuthenticationId",
                      "type": "string"
                    },
                    {
                      "name": "FileEcpBitmask",
                      "type": "string"
                    },
                    {
                      "name": "MajorFunction",
                      "type": "string"
                    },
                    {
                      "name": "TemporaryFileName",
                      "type": "string"
                    },
                    {
                      "name": "VolumeSessionUUID",
                      "type": "string"
                    },
                    {
                      "name": "PatternId",
                      "type": "string"
                    },
                    {
                      "name": "EventOrigin",
                      "type": "string"
                    },
                    {
                      "name": "MSOfficeSubType",
                      "type": "string"
                    },
                    {
                      "name": "GID",
                      "type": "string"
                    },
                    {
                      "name": "UnixMode",
                      "type": "string"
                    },
                    {
                      "name": "USN",
                      "type": "string"
                    },
                    {
                      "name": "FileCategory",
                      "type": "string"
                    },
                    {
                      "name": "ShareAccess",
                      "type": "string"
                    },
                    {
                      "name": "DesiredAccess",
                      "type": "string"
                    },
                    {
                      "name": "ELFSubType",
                      "type": "string"
                    },
                    {
                      "name": "IsTransactedFile",
                      "type": "string"
                    },
                    {
                      "name": "MachOSubType",
                      "type": "string"
                    },
                    {
                      "name": "VnodeModificationType",
                      "type": "string"
                    },
                    {
                      "name": "NewFileIdentifier",
                      "type": "string"
                    },
                    {
                      "name": "Options",
                      "type": "string"
                    },
                    {
                      "name": "Information",
                      "type": "string"
                    },
                    {
                      "name": "FileAttributes",
                      "type": "string"
                    },
                    {
                      "name": "Tags",
                      "type": "string"
                    },
                    {
                      "name": "FixedFileVersion",
                      "type": "string"
                    },
                    {
                      "name": "HandleCreateAuthenticationId",
                      "type": "string"
                    },
                    {
                      "name": "FileFlags",
                      "type": "string"
                    },
                    {
                      "name": "VnodeType",
                      "type": "string"
                    },
                    {
                      "name": "ConfigStateHash",
                      "type": "string"
                    },
                    {
                      "name": "ContextThreadId",
                      "type": "string"
                    },
                    {
                      "name": "BoundingLimitCount",
                      "type": "long"
                    },
                    {
                      "name": "BoundingLimitDuration",
                      "type": "string"
                    },
                    {
                      "name": "Entitlements",
                      "type": "string"
                    },
                    {
                      "name": "EffectiveTransmissionClass",
                      "type": "string"
                    },
                    {
                      "name": "cid",
                      "type": "string"
                    },
                    {
                      "name": "OciContainerId",
                      "type": "string"
                    },
                    {
                      "name": "TreeId",
                      "type": "string"
                    },
                    {
                      "name": "AdditionalFields",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            },
            {
              "condition": "[variables('flag-raw-copy-normdata')]",
              "name": "[concat(variables('loganalyticsworkspace'),'/',variables('cust-table-csnetwork'))]",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "apiVersion": "2022-10-01",
              "tags": {},
              "properties": {
                "plan": "[variables('table-tier-for-raw-copy')]",
                "schema": {
                  "name": "[variables('cust-table-csnetwork')]",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "DateTime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                    },
                    {
                      "name": "event_simpleName",
                      "type": "string"
                    },
                    {
                      "name": "timestamp",
                      "type": "long"
                    },
                    {
                      "name": "aip",
                      "type": "string"
                    },
                    {
                      "name": "aid",
                      "type": "string"
                    },
                    {
                      "name": "UserName",
                      "type": "string"
                    },
                    {
                      "name": "event_platform",
                      "type": "string"
                    },
                    {
                      "name": "ContextTimeStamp",
                      "type": "real"
                    },
                    {
                      "name": "name",
                      "type": "string"
                    },
                    {
                      "name": "ConfigBuild",
                      "type": "string"
                    },
                    {
                      "name": "CrowdStrikeId",
                      "type": "string"
                    },
                    {
                      "name": "ConfigStateHash",
                      "type": "string"
                    },
                    {
                      "name": "ContextProcessId",
                      "type": "string"
                    },
                    {
                      "name": "ContextThreadId",
                      "type": "string"
                    },
                    {
                      "name": "BoundingLimitCount",
                      "type": "long"
                    },
                    {
                      "name": "BoundingLimitDuration",
                      "type": "string"
                    },
                    {
                      "name": "Entitlements",
                      "type": "string"
                    },
                    {
                      "name": "EffectiveTransmissionClass",
                      "type": "string"
                    },
                    {
                      "name": "cid",
                      "type": "string"
                    },
                    {
                      "name": "OciContainerId",
                      "type": "string"
                    },
                    {
                      "name": "TreeId",
                      "type": "string"
                    },
                    {
                      "name": "ConnectionDirection",
                      "type": "string"
                    },
                    {
                      "name": "RemotePort",
                      "type": "long"
                    },
                    {
                      "name": "LocalAddressIP6",
                      "type": "string"
                    },
                    {
                      "name": "RemoteAddressIP6",
                      "type": "string"
                    },
                    {
                      "name": "LocalPort",
                      "type": "long"
                    },
                    {
                      "name": "Protocol",
                      "type": "string"
                    },
                    {
                      "name": "RemoteAddressString",
                      "type": "string"
                    },
                    {
                      "name": "FirewallAction",
                      "type": "string"
                    },
                    {
                      "name": "NegateLocalAddress",
                      "type": "string"
                    },
                    {
                      "name": "RemoteAddressMaskIP6",
                      "type": "string"
                    },
                    {
                      "name": "LocalAddressMaskIP6",
                      "type": "string"
                    },
                    {
                      "name": "NegateRemoteAddress",
                      "type": "string"
                    },
                    {
                      "name": "IcmpCode",
                      "type": "string"
                    },
                    {
                      "name": "IcmpType",
                      "type": "string"
                    },
                    {
                      "name": "LocalAddressIP4",
                      "type": "string"
                    },
                    {
                      "name": "RemoteAddressIP4",
                      "type": "string"
                    },
                    {
                      "name": "RemoteAddressMaskIP4",
                      "type": "string"
                    },
                    {
                      "name": "LocalAddressMaskIP4",
                      "type": "string"
                    },
                    {
                      "name": "PhysicalAddress",
                      "type": "string"
                    },
                    {
                      "name": "ConnectionFlags",
                      "type": "string"
                    },
                    {
                      "name": "InContext",
                      "type": "string"
                    },
                    {
                      "name": "EventOrigin",
                      "type": "string"
                    },
                    {
                      "name": "InterfaceIndex",
                      "type": "long"
                    },
                    {
                      "name": "NetLuidIndex",
                      "type": "long"
                    },
                    {
                      "name": "NeighborList",
                      "type": "string"
                    },
                    {
                      "name": "TcpConnectErrorCode",
                      "type": "string"
                    },
                    {
                      "name": "InterfaceAlias",
                      "type": "string"
                    },
                    {
                      "name": "NegateInterface",
                      "type": "string"
                    },
                    {
                      "name": "IsUnique",
                      "type": "string"
                    },
                    {
                      "name": "LocalPortRangeStart",
                      "type": "string"
                    },
                    {
                      "name": "LocalPortRangeOperation",
                      "type": "string"
                    },
                    {
                      "name": "RemotePortRangeOperation",
                      "type": "string"
                    },
                    {
                      "name": "RemotePortRangeStart",
                      "type": "string"
                    },
                    {
                      "name": "HbfwRuleId",
                      "type": "string"
                    },
                    {
                      "name": "NetworkProfile",
                      "type": "string"
                    },
                    {
                      "name": "PolicyIdentifier",
                      "type": "string"
                    },
                    {
                      "name": "HbfwRuleFlags",
                      "type": "string"
                    },
                    {
                      "name": "ImageFileName",
                      "type": "string"
                    },
                    {
                      "name": "CommandLine",
                      "type": "string"
                    },
                    {
                      "name": "RuleAction",
                      "type": "string"
                    },
                    {
                      "name": "RuleMatchCount",
                      "type": "long"
                    },
                    {
                      "name": "RuleMatchCountSinceLastReport",
                      "type": "long"
                    },
                    {
                      "name": "AdditionalFields",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            }
          ]
        },
        "parameters": {}
      },
      "subscriptionId": "[variables('loganalyticsworkspace-subscription')]",
      "resourceGroup": "[variables('loganalyticsworkspace-resourceGroup')]"
    },
    {
      "type": "Microsoft.Insights/dataCollectionRules",
      "apiVersion": "2022-06-01",
      "name": "[variables('dcr-raw-data')]",
      "location": "[variables('loganalyticsworkspace-location')]",
      "tags": {
        "createdBy": "Sentinel"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dce-name'))]"
      ],
      "properties": {
        "dataCollectionEndpointId": "[resourceId(subscription().subscriptionId, resourceGroup().name, 'Microsoft.Insights/dataCollectionEndpoints', variables('dce-name'))]",
        "streamDeclarations": {
          "Custom-CrowdstrikeDns": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "UserName",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "ConfigStateHash",
                "type": "string"
              },
              {
                "name": "ContextProcessId",
                "type": "string"
              },
              {
                "name": "ContextThreadId",
                "type": "string"
              },
              {
                "name": "BoundingLimitCount",
                "type": "string"
              },
              {
                "name": "BoundingLimitDuration",
                "type": "string"
              },
              {
                "name": "Entitlements",
                "type": "string"
              },
              {
                "name": "EffectiveTransmissionClass",
                "type": "string"
              },
              {
                "name": "cid",
                "type": "string"
              },
              {
                "name": "OciContainerId",
                "type": "string"
              },
              {
                "name": "TreeId",
                "type": "string"
              },
              {
                "name": "DomainName",
                "type": "string"
              },
              {
                "name": "RequestType",
                "type": "string"
              },
              {
                "name": "IP4Records",
                "type": "string"
              },
              {
                "name": "QueryStatus",
                "type": "string"
              },
              {
                "name": "FirstIP4Record",
                "type": "string"
              },
              {
                "name": "DnsRequestCount",
                "type": "string"
              },
              {
                "name": "IP6Records",
                "type": "string"
              },
              {
                "name": "InterfaceIndex",
                "type": "string"
              },
              {
                "name": "DualRequest",
                "type": "string"
              },
              {
                "name": "DnsResponseType",
                "type": "string"
              },
              {
                "name": "EventOrigin",
                "type": "string"
              },
              {
                "name": "RespondingDnsServer",
                "type": "string"
              },
              {
                "name": "CNAMERecords",
                "type": "string"
              },
              {
                "name": "FirstIP6Record",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              }
            ]
          },
          "Custom-CrowdstrikeFile": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "ContextProcessId",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "UserName",
                "type": "string"
              },
              {
                "name": "TargetFileName",
                "type": "string"
              },
              {
                "name": "FileOperatorSid",
                "type": "string"
              },
              {
                "name": "Size",
                "type": "string"
              },
              {
                "name": "FileWrittenFlags",
                "type": "string"
              },
              {
                "name": "OperationFlags",
                "type": "string"
              },
              {
                "name": "SHA256HashData",
                "type": "string"
              },
              {
                "name": "SourceFileName",
                "type": "string"
              },
              {
                "name": "CommandLine",
                "type": "string"
              },
              {
                "name": "OriginalFilename",
                "type": "string"
              },
              {
                "name": "ClientId",
                "type": "string"
              },
              {
                "name": "TargetDirectoryName",
                "type": "string"
              },
              {
                "name": "UID",
                "type": "string"
              },
              {
                "name": "Status",
                "type": "string"
              },
              {
                "name": "ImageFileName",
                "type": "string"
              },
              {
                "name": "IsOnRemovableDisk",
                "type": "string"
              },
              {
                "name": "MinorFunction",
                "type": "string"
              },
              {
                "name": "IsOnNetwork",
                "type": "string"
              },
              {
                "name": "FileIdentifier",
                "type": "string"
              },
              {
                "name": "TokenType",
                "type": "string"
              },
              {
                "name": "DiskParentDeviceInstanceId",
                "type": "string"
              },
              {
                "name": "FileObject",
                "type": "string"
              },
              {
                "name": "IrpFlags",
                "type": "string"
              },
              {
                "name": "AuthenticationId",
                "type": "string"
              },
              {
                "name": "FileEcpBitmask",
                "type": "string"
              },
              {
                "name": "MajorFunction",
                "type": "string"
              },
              {
                "name": "TemporaryFileName",
                "type": "string"
              },
              {
                "name": "VolumeSessionUUID",
                "type": "string"
              },
              {
                "name": "PatternId",
                "type": "string"
              },
              {
                "name": "EventOrigin",
                "type": "string"
              },
              {
                "name": "MSOfficeSubType",
                "type": "string"
              },
              {
                "name": "GID",
                "type": "string"
              },
              {
                "name": "UnixMode",
                "type": "string"
              },
              {
                "name": "USN",
                "type": "string"
              },
              {
                "name": "FileCategory",
                "type": "string"
              },
              {
                "name": "ShareAccess",
                "type": "string"
              },
              {
                "name": "DesiredAccess",
                "type": "string"
              },
              {
                "name": "ELFSubType",
                "type": "string"
              },
              {
                "name": "IsTransactedFile",
                "type": "string"
              },
              {
                "name": "MachOSubType",
                "type": "string"
              },
              {
                "name": "VnodeModificationType",
                "type": "string"
              },
              {
                "name": "NewFileIdentifier",
                "type": "string"
              },
              {
                "name": "Options",
                "type": "string"
              },
              {
                "name": "Information",
                "type": "string"
              },
              {
                "name": "FileAttributes",
                "type": "string"
              },
              {
                "name": "Tags",
                "type": "string"
              },
              {
                "name": "FixedFileVersion",
                "type": "string"
              },
              {
                "name": "HandleCreateAuthenticationId",
                "type": "string"
              },
              {
                "name": "VnodeType",
                "type": "string"
              },
              {
                "name": "ConfigStateHash",
                "type": "string"
              },
              {
                "name": "ContextThreadId",
                "type": "string"
              },
              {
                "name": "BoundingLimitCount",
                "type": "string"
              },
              {
                "name": "BoundingLimitDuration",
                "type": "string"
              },
              {
                "name": "Entitlements",
                "type": "string"
              },
              {
                "name": "EffectiveTransmissionClass",
                "type": "string"
              },
              {
                "name": "cid",
                "type": "string"
              },
              {
                "name": "OciContainerId",
                "type": "string"
              },
              {
                "name": "TreeId",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              }
            ]
          },
          "Custom-CrowdstrikeNetwork": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "UserName",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "ConfigStateHash",
                "type": "string"
              },
              {
                "name": "ContextProcessId",
                "type": "string"
              },
              {
                "name": "ContextThreadId",
                "type": "string"
              },
              {
                "name": "BoundingLimitCount",
                "type": "string"
              },
              {
                "name": "BoundingLimitDuration",
                "type": "string"
              },
              {
                "name": "Entitlements",
                "type": "string"
              },
              {
                "name": "EffectiveTransmissionClass",
                "type": "string"
              },
              {
                "name": "cid",
                "type": "string"
              },
              {
                "name": "OciContainerId",
                "type": "string"
              },
              {
                "name": "TreeId",
                "type": "string"
              },
              {
                "name": "ConnectionDirection",
                "type": "string"
              },
              {
                "name": "RemotePort",
                "type": "string"
              },
              {
                "name": "LocalAddressIP6",
                "type": "string"
              },
              {
                "name": "RemoteAddressIP6",
                "type": "string"
              },
              {
                "name": "LocalPort",
                "type": "string"
              },
              {
                "name": "Protocol",
                "type": "string"
              },
              {
                "name": "RemoteAddressString",
                "type": "string"
              },
              {
                "name": "FirewallAction",
                "type": "string"
              },
              {
                "name": "NegateLocalAddress",
                "type": "string"
              },
              {
                "name": "RemoteAddressMaskIP6",
                "type": "string"
              },
              {
                "name": "LocalAddressMaskIP6",
                "type": "string"
              },
              {
                "name": "NegateRemoteAddress",
                "type": "string"
              },
              {
                "name": "IcmpCode",
                "type": "string"
              },
              {
                "name": "IcmpType",
                "type": "string"
              },
              {
                "name": "LocalAddressIP4",
                "type": "string"
              },
              {
                "name": "RemoteAddressIP4",
                "type": "string"
              },
              {
                "name": "RemoteAddressMaskIP4",
                "type": "string"
              },
              {
                "name": "LocalAddressMaskIP4",
                "type": "string"
              },
              {
                "name": "PhysicalAddress",
                "type": "string"
              },
              {
                "name": "ConnectionFlags",
                "type": "string"
              },
              {
                "name": "InContext",
                "type": "string"
              },
              {
                "name": "EventOrigin",
                "type": "string"
              },
              {
                "name": "InterfaceIndex",
                "type": "string"
              },
              {
                "name": "NetLuidIndex",
                "type": "string"
              },
              {
                "name": "NeighborList",
                "type": "string"
              },
              {
                "name": "TcpConnectErrorCode",
                "type": "string"
              },
              {
                "name": "InterfaceAlias",
                "type": "string"
              },
              {
                "name": "NegateInterface",
                "type": "string"
              },
              {
                "name": "IsUnique",
                "type": "string"
              },
              {
                "name": "LocalPortRangeStart",
                "type": "string"
              },
              {
                "name": "LocalPortRangeOperation",
                "type": "string"
              },
              {
                "name": "RemotePortRangeOperation",
                "type": "string"
              },
              {
                "name": "RemotePortRangeStart",
                "type": "string"
              },
              {
                "name": "HbfwRuleId",
                "type": "string"
              },
              {
                "name": "NetworkProfile",
                "type": "string"
              },
              {
                "name": "PolicyIdentifier",
                "type": "string"
              },
              {
                "name": "HbfwRuleFlags",
                "type": "string"
              },
              {
                "name": "ImageFileName",
                "type": "string"
              },
              {
                "name": "CommandLine",
                "type": "string"
              },
              {
                "name": "RuleAction",
                "type": "string"
              },
              {
                "name": "RuleMatchCount",
                "type": "string"
              },
              {
                "name": "RuleMatchCountSinceLastReport",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              }
            ]
          },
          "Custom-CrowdstrikeAudit": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "UserName",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "ConfigStateHash",
                "type": "string"
              },
              {
                "name": "ContextProcessId",
                "type": "string"
              },
              {
                "name": "ContextThreadId",
                "type": "string"
              },
              {
                "name": "BoundingLimitCount",
                "type": "string"
              },
              {
                "name": "BoundingLimitDuration",
                "type": "string"
              },
              {
                "name": "Entitlements",
                "type": "string"
              },
              {
                "name": "EffectiveTransmissionClass",
                "type": "string"
              },
              {
                "name": "cid",
                "type": "string"
              },
              {
                "name": "OciContainerId",
                "type": "string"
              },
              {
                "name": "TreeId",
                "type": "string"
              },
              {
                "name": "VolumeSnapshotName",
                "type": "string"
              },
              {
                "name": "SmbShareName",
                "type": "string"
              },
              {
                "name": "ShareName",
                "type": "string"
              },
              {
                "name": "UploadId",
                "type": "string"
              },
              {
                "name": "SessionId",
                "type": "string"
              },
              {
                "name": "ComputerName",
                "type": "string"
              },
              {
                "name": "FirewallRule",
                "type": "string"
              },
              {
                "name": "FirewallRuleId",
                "type": "string"
              },
              {
                "name": "FirewallOption",
                "type": "string"
              },
              {
                "name": "SourceFileName",
                "type": "string"
              },
              {
                "name": "TargetFileName",
                "type": "string"
              },
              {
                "name": "DeviceVendorId",
                "type": "string"
              },
              {
                "name": "DeviceProductId",
                "type": "string"
              },
              {
                "name": "DeviceSerialNumber",
                "type": "string"
              },
              {
                "name": "BluetoothDeviceAddress",
                "type": "string"
              },
              {
                "name": "EnvironmentVariableName",
                "type": "string"
              },
              {
                "name": "SamAccountName",
                "type": "string"
              },
              {
                "name": "FirewallOptionNumericValue",
                "type": "string"
              },
              {
                "name": "FirewallOptionStringValue",
                "type": "string"
              },
              {
                "name": "FileVaultIsEnabled",
                "type": "string"
              },
              {
                "name": "EnvironmentVariableValue",
                "type": "string"
              },
              {
                "name": "ConfigStateData",
                "type": "string"
              },
              {
                "name": "ActiveDirectoryOuDn",
                "type": "string"
              },
              {
                "name": "ActiveDirectoryDepartment",
                "type": "string"
              },
              {
                "name": "SHA256HashData",
                "type": "string"
              },
              {
                "name": "CommandLine",
                "type": "string"
              },
              {
                "name": "VolumeName",
                "type": "string"
              },
              {
                "name": "VolumeDriveLetter",
                "type": "string"
              },
              {
                "name": "TokenType",
                "type": "string"
              },
              {
                "name": "InterfaceGuid",
                "type": "string"
              },
              {
                "name": "RpcClientProcessId",
                "type": "string"
              },
              {
                "name": "InterfaceVersion",
                "type": "string"
              },
              {
                "name": "RpcClientThreadId",
                "type": "string"
              },
              {
                "name": "AuthenticationId",
                "type": "string"
              },
              {
                "name": "ImageFileName",
                "type": "string"
              },
              {
                "name": "RpcOpNum",
                "type": "string"
              },
              {
                "name": "RpcNestingLevel",
                "type": "string"
              },
              {
                "name": "ClientComputerName",
                "type": "string"
              },
              {
                "name": "DomainName",
                "type": "string"
              },
              {
                "name": "RemoteAddressIP6",
                "type": "string"
              },
              {
                "name": "RemoteAddressIP4",
                "type": "string"
              },
              {
                "name": "SmbClientName",
                "type": "string"
              },
              {
                "name": "AgentLoadFlags",
                "type": "string"
              },
              {
                "name": "ProvisioningDuration",
                "type": "string"
              },
              {
                "name": "Status",
                "type": "string"
              },
              {
                "name": "ErrorText",
                "type": "string"
              },
              {
                "name": "CloudErrorCode",
                "type": "string"
              },
              {
                "name": "SharePath",
                "type": "string"
              },
              {
                "name": "ShareMaxCount",
                "type": "string"
              },
              {
                "name": "ShareRemark",
                "type": "string"
              },
              {
                "name": "ShareData",
                "type": "string"
              },
              {
                "name": "IntelTDTEnabled",
                "type": "string"
              },
              {
                "name": "FalconServiceState",
                "type": "string"
              },
              {
                "name": "LfoUploadFlags",
                "type": "string"
              },
              {
                "name": "AttemptNumber",
                "type": "string"
              },
              {
                "name": "Size",
                "type": "string"
              },
              {
                "name": "Tags",
                "type": "string"
              },
              {
                "name": "CloudRequestId",
                "type": "string"
              },
              {
                "name": "LocalSession",
                "type": "string"
              },
              {
                "name": "IOServiceClass",
                "type": "string"
              },
              {
                "name": "IOServicePath",
                "type": "string"
              },
              {
                "name": "IOServiceProperties",
                "type": "string"
              },
              {
                "name": "IOServiceName",
                "type": "string"
              },
              {
                "name": "Protocol",
                "type": "string"
              },
              {
                "name": "ChannelDiffStatusList",
                "type": "string"
              },
              {
                "name": "AccountDomain",
                "type": "string"
              },
              {
                "name": "AccountObjectGuid",
                "type": "string"
              },
              {
                "name": "AccountObjectSid",
                "type": "string"
              },
              {
                "name": "TotalCount",
                "type": "string"
              },
              {
                "name": "ErrorCode",
                "type": "string"
              },
              {
                "name": "EventOrigin",
                "type": "string"
              },
              {
                "name": "AddressFamily",
                "type": "string"
              },
              {
                "name": "BluetoothDeviceType",
                "type": "string"
              },
              {
                "name": "DeviceTimeStamp",
                "type": "string"
              },
              {
                "name": "DeviceInstanceId",
                "type": "string"
              },
              {
                "name": "BluetoothDeviceAddressType",
                "type": "string"
              },
              {
                "name": "DeviceVersion",
                "type": "string"
              },
              {
                "name": "DeviceDescriptorSetHash",
                "type": "string"
              },
              {
                "name": "DeviceManufacturer",
                "type": "string"
              },
              {
                "name": "DeviceProduct",
                "type": "string"
              },
              {
                "name": "DeviceUserSid",
                "type": "string"
              },
              {
                "name": "DeviceUserAuthenticationId",
                "type": "string"
              },
              {
                "name": "FirewallProfile",
                "type": "string"
              },
              {
                "name": "ShareAccess",
                "type": "string"
              },
              {
                "name": "DesiredAccess",
                "type": "string"
              },
              {
                "name": "GID",
                "type": "string"
              },
              {
                "name": "UID",
                "type": "string"
              },
              {
                "name": "UnixMode",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              }
            ]
          },
        "destinations": {
          "logAnalytics": [
            {
              "name": "myworkspace",
              "workspaceResourceId": "[resourceId(variables('loganalyticsworkspace-subscription'), variables('loganalyticsworkspace-resourceGroup'), 'Microsoft.OperationalInsights/Workspaces', variables('loganalyticsworkspace'))]"
            }
          ]
        },
        "dataFlows": [
          {
            "streams": [
              "Custom-CrowdstrikeNetwork"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "source\r\n| extend eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01'))\r\n| extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n| project-rename \r\n        CrowdStrikeId = ['id']\r\n| extend \r\n        timestamp = tolong(timestamp),\r\n        ContextTimeStamp = todouble(ContextTimeStamp),        \r\n        BoundingLimitCount = tolong(BoundingLimitCount),        \r\n        RemotePort = tolong(RemotePort),\r\n        LocalPort = tolong(LocalPort),\r\n        InterfaceIndex = tolong(InterfaceIndex),\r\n        NetLuidIndex = tolong(NetLuidIndex),\r\n        RuleMatchCount = tolong(RuleMatchCount),\r\n        RuleMatchCountSinceLastReport = tolong(RuleMatchCountSinceLastReport),\r\n        AdditionalFields = todynamic(AdditionalFields)",
            "outputStream": "[concat('Custom-',variables('cust-table-csnetwork'))]"
          },
          {
            "streams": [
              "Custom-CrowdstrikeDns"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "source\r\n| extend eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01'))\r\n| extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n| project-rename \r\n    CrowdStrikeId = ['id']\r\n| extend \r\n        timestamp = tolong(timestamp),\r\n        ContextTimeStamp = todouble(ContextTimeStamp),\r\n        BoundingLimitCount = tolong(BoundingLimitCount),\r\n        DnsRequestCount = tolong(DnsRequestCount),\r\n        InterfaceIndex = tolong(InterfaceIndex),\r\n        AdditionalFields = todynamic(AdditionalFields)",
            "outputStream": "[concat('Custom-',variables('cust-table-csdns'))]"
          },
          {
            "streams": [
              "Custom-CrowdstrikeFile"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "source\r\n| extend eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01'))\r\n| extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n| project-rename \r\n        CrowdStrikeId = ['id']\r\n| extend \r\n        timestamp = tolong(timestamp),\r\n        ContextTimeStamp = todouble(ContextTimeStamp),\r\n        BoundingLimitCount = tolong(BoundingLimitCount),\r\n        Size = tolong(Size),\r\n        AdditionalFields = todynamic(AdditionalFields)",
            "outputStream": "[concat('Custom-',variables('cust-table-csfile'))]"
          },
          {
            "streams": [
              "Custom-CrowdstrikeAudit"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "source\r\n| extend eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01'))\r\n| extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n| project-rename \r\n        CrowdStrikeId = ['id']\r\n| extend \r\n        timestamp = tolong(timestamp),\r\n        ContextTimeStamp = todouble(ContextTimeStamp),\r\n        BoundingLimitCount = tolong(BoundingLimitCount),\r\n        FileVaultIsEnabled = tobool(FileVaultIsEnabled),\r\n        ShareMaxCount = tolong(ShareMaxCount),\r\n        AttemptNumber = tolong(AttemptNumber),\r\n        TotalCount = tolong(TotalCount),\r\n        DeviceTimeStamp = todouble(DeviceTimeStamp),\r\n        AdditionalFields = todynamic(AdditionalFields)",
            "outputStream": "[concat('Custom-',variables('cust-table-csaudit'))]"
          },
        ]
      },
      "condition": "[and(variables('dcr-raw-data_refresh_flag'), variables('flag-raw-copy-normdata'))]"
    },
    {
      "type": "Microsoft.Insights/dataCollectionRules",
      "apiVersion": "2022-06-01",
      "name": "[variables('dcr-normalized-data')]",
      "location": "[variables('loganalyticsworkspace-location')]",
      "tags": {
        "createdBy": "Sentinel"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Insights/dataCollectionEndpoints', variables('dce-name'))]"
      ],
      "properties": {
        "dataCollectionEndpointId": "[resourceId(subscription().subscriptionId,resourceGroup().name,'Microsoft.Insights/dataCollectionEndpoints', variables('dce-name'))]",
        "streamDeclarations": {
          "Custom-CrowdstrikeDns": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "ContextProcessId",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "DomainName",
                "type": "string"
              },
              {
                "name": "RequestType",
                "type": "string"
              },
              {
                "name": "IP4Records",
                "type": "string"
              },
              {
                "name": "QueryStatus",
                "type": "string"
              },
              {
                "name": "FirstIP4Record",
                "type": "string"
              },
              {
                "name": "DnsRequestCount",
                "type": "string"
              },
              {
                "name": "IP6Records",
                "type": "string"
              },
              {
                "name": "RespondingDnsServer",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              }
            ]
          },
          "Custom-CrowdstrikeFile": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "ContextProcessId",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "UserName",
                "type": "string"
              },
              {
                "name": "TargetFileName",
                "type": "string"
              },
              {
                "name": "FileOperatorSid",
                "type": "string"
              },
              {
                "name": "Size",
                "type": "string"
              },
              {
                "name": "FileWrittenFlags",
                "type": "string"
              },
              {
                "name": "OperationFlags",
                "type": "string"
              },
              {
                "name": "SHA256HashData",
                "type": "string"
              },
              {
                "name": "SourceFileName",
                "type": "string"
              },
              {
                "name": "CommandLine",
                "type": "string"
              },
              {
                "name": "OriginalFilename",
                "type": "string"
              },
              {
                "name": "ClientId",
                "type": "string"
              },
              {
                "name": "TargetDirectoryName",
                "type": "string"
              },
              {
                "name": "UID",
                "type": "string"
              },
              {
                "name": "Status",
                "type": "string"
              },
              {
                "name": "ImageFileName",
                "type": "string"
              },
              {
                "name": "FileEventType",
                "type": "string"
              },
              {
                "name": "FileSystemOperationType",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              }
            ]
          },
          "Custom-CrowdstrikeNetwork": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "ConnectionDirection",
                "type": "string"
              },
              {
                "name": "RemotePort",
                "type": "string"
              },
              {
                "name": "LocalAddressIP6",
                "type": "string"
              },
              {
                "name": "RemoteAddressIP6",
                "type": "string"
              },
              {
                "name": "LocalPort",
                "type": "string"
              },
              {
                "name": "Protocol",
                "type": "string"
              },
              {
                "name": "RemoteAddressString",
                "type": "string"
              },
              {
                "name": "FirewallAction",
                "type": "string"
              },
              {
                "name": "NegateLocalAddress",
                "type": "string"
              },
              {
                "name": "RemoteAddressMaskIP6",
                "type": "string"
              },
              {
                "name": "LocalAddressMaskIP6",
                "type": "string"
              },
              {
                "name": "NegateRemoteAddress",
                "type": "string"
              },
              {
                "name": "IcmpCode",
                "type": "string"
              },
              {
                "name": "IcmpType",
                "type": "string"
              },
              {
                "name": "LocalAddressIP4",
                "type": "string"
              },
              {
                "name": "RemoteAddressIP4",
                "type": "string"
              },
              {
                "name": "RemoteAddressMaskIP4",
                "type": "string"
              },
              {
                "name": "LocalAddressMaskIP4",
                "type": "string"
              },
              {
                "name": "PhysicalAddress",
                "type": "string"
              },
              {
                "name": "InterfaceAlias",
                "type": "string"
              },
              {
                "name": "PolicyIdentifier",
                "type": "string"
              },
              {
                "name": "RuleAction",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              }
            ]
          },
          "Custom-CrowdstrikeAudit": {
            "columns": [
              {
                "name": "event_simpleName",
                "type": "string"
              },
              {
                "name": "timestamp",
                "type": "string"
              },
              {
                "name": "aip",
                "type": "string"
              },
              {
                "name": "aid",
                "type": "string"
              },
              {
                "name": "event_platform",
                "type": "string"
              },
              {
                "name": "ContextTimeStamp",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "ConfigBuild",
                "type": "string"
              },
              {
                "name": "ContextProcessId",
                "type": "string"
              },
              {
                "name": "id",
                "type": "string"
              },
              {
                "name": "UserName",
                "type": "string"
              },
              {
                "name": "AdditionalFields",
                "type": "string"
              },
              {
                "name": "VolumeSnapshotName",
                "type": "string"
              },
              {
                "name": "SmbShareName",
                "type": "string"
              },
              {
                "name": "ShareName",
                "type": "string"
              },
              {
                "name": "UploadId",
                "type": "string"
              },
              {
                "name": "SessionId",
                "type": "string"
              },
              {
                "name": "ComputerName",
                "type": "string"
              },
              {
                "name": "FirewallRule",
                "type": "string"
              },
              {
                "name": "FirewallRuleId",
                "type": "string"
              },
              {
                "name": "FirewallOption",
                "type": "string"
              },
              {
                "name": "SourceFileName",
                "type": "string"
              },
              {
                "name": "TargetFileName",
                "type": "string"
              },
              {
                "name": "DeviceVendorId",
                "type": "string"
              },
              {
                "name": "DeviceProductId",
                "type": "string"
              },
              {
                "name": "DeviceSerialNumber",
                "type": "string"
              },
              {
                "name": "BluetoothDeviceAddress",
                "type": "string"
              },
              {
                "name": "EnvironmentVariableName",
                "type": "string"
              },
              {
                "name": "SamAccountName",
                "type": "string"
              },
              {
                "name": "FirewallOptionNumericValue",
                "type": "string"
              },
              {
                "name": "FirewallOptionStringValue",
                "type": "string"
              },
              {
                "name": "FileVaultIsEnabled",
                "type": "string"
              },
              {
                "name": "EnvironmentVariableValue",
                "type": "string"
              },
              {
                "name": "ConfigStateData",
                "type": "string"
              },
              {
                "name": "ActiveDirectoryOuDn",
                "type": "string"
              },
              {
                "name": "ActiveDirectoryDepartment",
                "type": "string"
              },
              {
                "name": "IOServiceName",
                "type": "string"
              }
            ]
          },
        "destinations": {
          "logAnalytics": [
            {
              "name": "myworkspace",
              "workspaceResourceId": "[resourceId(variables('loganalyticsworkspace-subscription'), variables('loganalyticsworkspace-resourceGroup'),'Microsoft.OperationalInsights/Workspaces', variables('loganalyticsworkspace'))]"
            }
          ]
        },
        "dataFlows": [
          {
            "streams": [
              "Custom-CrowdstrikeNetwork"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "let NetworkDirectionLookup = parse_json('{0: \"Outbound\",1: \"Inbound\", 2: \"Local\", 3: \"Outbound\"}');\r\n    let NetworkProtocolLookup = parse_json('{0:\"HOPOPT\", 1:\"ICMP\", 2:\"IGMP\", 3:\"GGP\", 4:\"IPv4\", 5:\"ST\", 6:\"TCP\", 7:\"CBT\", 8:\"EGP\", 9:\"IGP\", 10:\"BBN-RCC-MON\", 11:\"NVP-II\", 12:\"PUP\", 13:\"ARGUS (deprecated)\", 14:\"EMCON\", 15:\"XNET\", 16:\"CHAOS\", 17:\"UDP\", 18:\"MUX\", 19:\"DCN-MEAS\", 20:\"HMP\", 21:\"PRM\", 22:\"XNS-IDP\", 23:\"TRUNK-1\", 24:\"TRUNK-2\", 25:\"LEAF-1\", 26:\"LEAF-2\", 27:\"RDP\", 28:\"IRTP\", 29:\"ISO-TP4\", 30:\"NETBLT\", 31:\"MFE-NSP\", 32:\"MERIT-INP\", 33:\"DCCP\", 34:\"3PC\", 35:\"IDPR\", 36:\"XTP\", 37:\"DDP\", 38:\"IDPR-CMTP\", 39:\"TP++\", 40:\"IL\", 41:\"IPv6\", 42:\"SDRP\", 43:\"IPv6-Route\", 44:\"IPv6-Frag\", 45:\"IDRP\", 46:\"RSVP\", 47:\"GRE\", 48:\"DSR\", 49:\"BNA\", 50:\"ESP\", 51:\"AH\", 52:\"I-NLSP\", 53:\"SWIPE (deprecated)\", 54:\"NARP\", 55:\"MOBILE\", 56:\"TLSP\", 57:\"SKIP\", 58:\"IPv6-ICMP\", 59:\"IPv6-NoNxt\", 60:\"IPv6-Opts\", 61:\"\", 62:\"CFTP\", 63:\"\", 64:\"SAT-EXPAK\", 65:\"KRYPTOLAN\", 66:\"RVD\", 67:\"IPPC\", 68:\"\", 69:\"SAT-MON\", 70:\"VISA\", 71:\"IPCV\", 72:\"CPNX\", 73:\"CPHB\", 74:\"WSN\", 75:\"PVP\", 76:\"BR-SAT-MON\", 77:\"SUN-ND\", 78:\"WB-MON\", 79:\"WB-EXPAK\", 80:\"ISO-IP\", 81:\"VMTP\", 82:\"SECURE-VMTP\", 83:\"VINES\", 84:\"TTP\", 84:\"IPTM\", 85:\"NSFNET-IGP\", 86:\"DGP\", 87:\"TCF\", 88:\"EIGRP\", 89:\"OSPFIGP\", 90:\"Sprite-RPC\", 91:\"LARP\", 92:\"MTP\", 93:\"AX.25\", 94:\"IPIP\", 95:\"MICP (deprecated)\", 96:\"SCC-SP\", 97:\"ETHERIP\", 98:\"ENCAP\", 99:\"\", 100:\"GMTP\", 101:\"IFMP\", 102:\"PNNI\", 103:\"PIM\", 104:\"ARIS\", 105:\"SCPS\", 106:\"QNX\", 107:\"A/N\", 108:\"IPComp\", 109:\"SNP\", 110:\"Compaq-Peer\", 111:\"IPX-in-IP\", 112:\"VRRP\", 113:\"PGM\", 114:\"\", 115:\"L2TP\", 116:\"DDX\", 117:\"IATP\", 118:\"STP\", 119:\"SRP\", 120:\"UTI\", 121:\"SMP\", 122:\"SM (deprecated)\", 123:\"PTP\", 124:\"ISIS over IPv4\", 125:\"FIRE\", 126:\"CRTP\", 127:\"CRUDP\", 128:\"SSCOPMCE\", 129:\"IPLT\", 130:\"SPS\", 131:\"PIPE\", 132:\"SCTP\", 133:\"FC\", 134:\"RSVP-E2E-IGNORE\", 135:\"Mobility Header\", 136:\"UDPLite\", 137:\"MPLS-in-IP\", 138:\"manet\", 139:\"HIP\", 140:\"Shim6\", 141:\"WESP\", 142:\"ROHC\", 143:\"Ethernet\", 253:\"\", 254:\"\", 255:\"Reserved\"}');\r\n    let DvcActionLookup = parse_json('{0: \"\", 1: \"Allow\", 2: \"Deny\"}');\r\n    let EventResultLookup = parse_json('{\"Allow\": \"Success\", \"Deny\": \"Failure\"}');\r\n    let EventSeverityLookup = parse_json('{\"Allow\": \"Informational\", \"Deny\": \"Low\"}');\r\n    let EventSubTypeLookup = parse_json('{\"NetworkConnectIP4\": \"Start\", \"NetworkConnectIP6\": \"Start\",\"NetworkReceiveAcceptIP4\": \"Start\", \"NetworkReceiveAcceptIP6\": \"Start\",\"NetworkCloseIP6\": \"End\", \"NetworkCloseIP4\": \"End\"}');\r\n    source\r\n    | extend eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01')),\r\n             contextDatetime = datetime_add('MilliSecond', tolong(todouble(ContextTimeStamp) * 1000), todatetime('1970-01-01'))\r\n    | extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n    | project-rename\r\n        DvcIpAddr = aip,\r\n        DvcId = aid,\r\n        EventOriginalType = name,\r\n        EventProductVersion = ConfigBuild,\r\n        EventOriginalUid = id,\r\n        NetworkIcmpType = IcmpType,\r\n        NetworkRuleName = PolicyIdentifier\r\n    | extend \r\n        EventStartTime = iff(isnotempty(contextDatetime),contextDatetime,TimeGenerated),\r\n        NetworkDirection = tostring(NetworkDirectionLookup[ConnectionDirection]),\r\n        NetworkProtocol = tostring(NetworkProtocolLookup[Protocol]),\r\n        FirewallDvcAction = tostring(DvcActionLookup[FirewallAction]),\r\n        RuleDvcAction = tostring(DvcActionLookup[RuleAction]),\r\n        RemotePortNumber = case(\r\n                          isnotempty(RemotePort),\r\n                          toint(RemotePort),\r\n                          toint(split(RemoteAddressString, \":\", 1)[0])\r\n                      ),\r\n        DvcOs = case(\r\n                event_platform == \"Win\",\r\n                \"Windows\", \r\n                event_platform == \"Mac\",\r\n                \"Macintosh\",\r\n                event_platform == \"Lin\",\r\n                \"Linux\", \r\n                \"\"\r\n            ),\r\n        LocalPortNumber = toint(LocalPort),\r\n        LocalIpAddr = case(\r\n                      isnotempty(LocalAddressIP6),\r\n                      LocalAddressIP6,\r\n                      isnotempty(LocalAddressIP4),\r\n                      LocalAddressIP4,\r\n                      NegateLocalAddress\r\n                  ),\r\n        RemoteIpAddr = case(\r\n                      isnotempty(RemoteAddressIP6),\r\n                      RemoteAddressIP6,\r\n                      isnotempty(RemoteAddressIP4),\r\n                      RemoteAddressIP4,\r\n                      isnotempty(RemoteAddressString),\r\n                      tostring(split(RemoteAddressString, \":\", 0)[0]),\r\n                      NegateRemoteAddress\r\n                  ),\r\n        LocalNatIpAddr = case(\r\n                        isnotempty(LocalAddressMaskIP6),\r\n                        LocalAddressMaskIP6,\r\n                        LocalAddressMaskIP4\r\n                    ),\r\n        RemoteNatIpAddr = case(\r\n                          isnotempty(RemoteAddressMaskIP6),\r\n                          RemoteAddressMaskIP6,\r\n                          RemoteAddressMaskIP4\r\n                      )\r\n    | extend\r\n        SrcPortNumber = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", RemotePortNumber, LocalPortNumber),    \r\n        DstPortNumber = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", LocalPortNumber, RemotePortNumber),\r\n        SrcIpAddr = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", RemoteIpAddr, LocalIpAddr),    \r\n        DstIpAddr = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", LocalIpAddr, RemoteIpAddr),\r\n        SrcNatIpAddr = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", RemoteNatIpAddr, LocalNatIpAddr),    \r\n        DstNatIpAddr = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", LocalNatIpAddr, RemoteNatIpAddr),    \r\n        DstInterfaceName = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", InterfaceAlias, \"\"),    \r\n        SrcInterfaceName = iff(NetworkDirection == \"Inbound\" or NetworkDirection == \"Local\", \"\", InterfaceAlias),\r\n        DstMacAddr = iff(event_simpleName in (\"LocalIpAddressIP4\", \"LocalIpAddressIP6\"), PhysicalAddress, \"\"),\r\n        NetworkIcmpCode = toint(IcmpCode),\r\n        EventSubType = tostring(EventSubTypeLookup[event_simpleName]),\r\n        AdditionalFields = todynamic(AdditionalFields),\r\n        EventEndTime = EventStartTime,\r\n        DvcAction = iff(isnotempty(FirewallDvcAction), FirewallDvcAction, RuleDvcAction),\r\n        DvcOriginalAction = iff(isnotempty(FirewallAction), FirewallAction, RuleAction),\r\n        EventType = \"NetworkSession\",\r\n        NetworkProtocolVersion = iff(event_simpleName contains \"IP4\", \"IPv4\", \"IPv6\"),\r\n        EventCount = toint(1),\r\n        EventSchemaVersion = \"0.2.6\",\r\n        EventVendor = \"CrowdStrike\",\r\n        EventProduct = \"Falcon Data Replicator\"\r\n    | extend\r\n        EventResult = iff(isnotempty(EventResultLookup[DvcAction]), tostring(EventResultLookup[DvcAction]), \"Success\"),\r\n        EventSeverity = iff(isnotempty(EventSeverityLookup[DvcAction]), tostring(EventSeverityLookup[DvcAction]), \"Informational\")",
            "outputStream": "Microsoft-ASimNetworkSessionLogs"
          },
          {
            "streams": [
              "Custom-CrowdstrikeDns"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "let DnsQueryTypeLookup = parse_json('{0: \"Reserved\",1: \"A\",2: \"NS\",3: \"MD\",4: \"MF\",5: \"CNAME\",6: \"SOA\",7: \"MB\",8: \"MG\",9: \"MR\",10: \"NULL\",11: \"WKS\",12: \"PTR\",13: \"HINFO\",14: \"MINFO\",15: \"MX\",16: \"TXT\",17: \"RP\",18: \"AFSDB\",19: \"X25\",20: \"ISDN\",21: \"RT\",22: \"NSAP\",23: \"NSAP-PTR\",24: \"SIG\",25: \"KEY\",26: \"PX\",27: \"GPOS\",28: \"AAAA\",29: \"LOC\",30: \"NXT\",31: \"EID\",32: \"NIMLOC\",33: \"SRV\",34: \"ATMA\",35: \"NAPTR\",36: \"KX\",37: \"CERT\",38: \"A6\",39: \"DNAME\",40: \"SINK\",41: \"OPT\",42: \"APL\",43: \"DS\",44: \"SSHFP\",45: \"IPSECKEY\",46: \"RRSIG\",47: \"NSEC\",48: \"DNSKEY\",49: \"DHCID\",50: \"NSEC3\",51: \"NSEC3PARAM\",52: \"TLSA\",53: \"SMIMEA\",55: \"HIP\",56: \"NINFO\",57: \"RKEY\",58: \"TALINK\",59: \"CDS\",60: \"CDNSKEY\",61: \"OPENPGPKEY\",62: \"CSYNC\",63: \"ZONEMD\",64: \"SVCB\",65: \"HTTPS\",99: \"SPF\",100: \"UINFO\",101: \"UID\",102: \"GID\",103: \"UNSPEC\",104: \"NID\",105: \"L32\",106: \"L64\",107: \"LP\",108: \"EUI48\",109: \"EUI64\",249: \"TKEY\",250: \"TSIG\",251: \"IXFR\",252: \"AXFR\",253: \"MAILB\",254: \"MAILA\",255: \"*\",256: \"URI\",257: \"CAA\",258: \"AVC\",259: \"DOA\",260: \"AMTRELAY\",32768: \"TA\",32769: \"DLV\",65535: \"Reserved\"}');\r\n    let EventResultDetailsLookup = parse_json('{0: \"No Error\",1: \"Format Error\",2: \"Server Failure\",3: \"Non-Existent Domain\",4: \"Not Implemented\",5: \"Query Refused\",6: \"Name Exists when it should not\",7: \"RR Set Exists when it should not\",8: \"RR Set that should exist does not\",9: \"Not Authorized\",10: \"Name not contained in zone\",11: \"DSO-TYPE Not Implemented\",16: \"Bad OPT Version \/ TSIG Signature Failure\",17: \"Key not recognized\",18: \"Signature out of time window\",19: \"Bad TKEY Mode\",20: \"Duplicate key name\",21: \"Algorithm not supported\",22: \"Bad Truncation\",23: \"Bad\/missing Server Cookie\",65535: \"Reserved, Can be allocated by Standards Action\"}');\r\n    source\r\n    | extend\r\n        eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01')),\r\n        contextDatetime = datetime_add('MilliSecond', tolong(todouble(ContextTimeStamp) * 1000), todatetime('1970-01-01'))\r\n    | extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n    | project-rename\r\n        DvcIpAddr = aip,\r\n        DvcId = aid,\r\n        EventOriginalType = name,\r\n        EventProductVersion = ConfigBuild,\r\n        EventOriginalUid = id,\r\n        SrcProcessId = ContextProcessId,\r\n        DnsQuery = DomainName,\r\n        DstIpAddr = RespondingDnsServer\r\n    | extend\r\n        DvcOs = case(\r\n                event_platform == \"Win\",\r\n                \"Windows\", \r\n                event_platform == \"Mac\",\r\n                \"Macintosh\",\r\n                event_platform == \"Lin\",\r\n                \"Linux\", \r\n                \"\"\r\n            ),\r\n        EventCount = iff(isnotempty(DnsRequestCount), toint(DnsRequestCount), toint(1)),\r\n        DnsResponseCode = toint(QueryStatus),\r\n        DnsQueryType = toint(RequestType)\r\n    | extend \r\n        EventStartTime = iff(isnotempty(contextDatetime), contextDatetime, TimeGenerated),\r\n        EventResultDetails = tostring(EventResultDetailsLookup[QueryStatus]),\r\n        DnsQueryTypeName = tostring(DnsQueryTypeLookup[RequestType]),\r\n        DnsResponseName = iff(isnotempty(IP4Records), IP4Records, \"\")\r\n    | extend\r\n        EventEndTime = EventStartTime,\r\n        EventSchemaVersion = \"0.1.7\",\r\n        EventVendor = \"CrowdStrike\",\r\n        EventProduct = \"Falcon Data Replicator\",\r\n        EventType = \"Query\",\r\n        EventSubType = case(\r\n                       event_simpleName == \"SuspiciousDnsRequest\",\r\n                       \"request\",\r\n                       \"response\"\r\n                   ),\r\n        EventResult = case(\r\n                      event_simpleName == \"SuspiciousDnsRequest\",\r\n                      \"Failure\",\r\n                      QueryStatus == \"0\",\r\n                      \"Success\", \r\n                      \"Failure\"\r\n                  ),\r\n        EventSeverity = case(\r\n                        event_simpleName == \"SuspiciousDnsRequest\",\r\n                        \"Medium\",\r\n                        QueryStatus == \"0\",\r\n                        \"Informational\", \r\n                        \"Low\"\r\n                    ) ",
            "outputStream": "Microsoft-ASimDnsActivityLogs"
          },
          {
            "streams": [
              "Custom-CrowdstrikeFile"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "let EventTypeSimpleNameLookup = parse_json('{\"ZipFileWritten\": \"FileModified\",  \"XarFileWritten\": \"FileModified\",  \"VmdkFileWritten\": \"FileModified\",  \"VdiFileWritten\": \"FileModified\",  \"TiffFileWritten\": \"FileModified\",  \"TarFileWritten\": \"FileModified\",  \"SuspiciousPeFileWritten\": \"FileModified\",  \"SuspiciousEseFileWritten\": \"FileModified\",  \"SldFileWritten\": \"FileModified\",  \"SevenZipFileWritten\": \"FileModified\",  \"RtfFileWritten\": \"FileModified\",  \"RpmFileWritten\": \"FileModified\",  \"RarFileWritten\": \"FileModified\",  \"RansomwareRenameFile\": \"FileRenamed\",  \"RansomwareOpenFile\": \"FileAccessed\",  \"RansomwareFileAccessPattern\": \"FileAccessed\",  \"RansomwareCreateFile\": \"FileCreated\",  \"PngFileWritten\": \"FileModified\", \"PeFileWritten\": \"FileCreated\",  \"PdfFileWritten\": \"FileModified\",  \"OoxmlFileWritten\": \"FileModified\",  \"OleFileWritten\": \"FileModified\",  \"NewScriptWritten\": \"FileCreated\",  \"NewExecutableWritten\": \"FileCreated\",  \"NewExecutableRenamed\": \"FileRenamed\",  \"MSXlsxFileWritten\": \"FileModified\",  \"MSVsdxFileWritten\": \"FileModified\",  \"MSPptxFileWritten\": \"FileModified\",  \"MsiFileWritten\": \"FileModified\",  \"MSDocxFileWritten\": \"FileModified\",  \"MachOFileWritten\": \"FileModified\",  \"LnkFileWritten\": \"FileModified\",  \"JpegFileWritten\": \"FileModified\",  \"JavaClassFileWritten\": \"FileModified\",  \"JarFileWritten\": \"FileModified\",  \"IdwFileWritten\": \"FileModified\",  \"GzipFileWritten\": \"FileModified\",  \"GifFileWritten\": \"FileModified\",  \"GenericFileWritten\": \"FileModified\", \"EseFileWritten\": \"FileModified\",  \"EmailFileWritten\": \"FileModified\",  \"EmailArchiveFileWritten\": \"FileModified\",  \"ELFFileWritten\": \"FileModified\",  \"DxfFileWritten\": \"FileModified\",  \"DwgFileWritten\": \"FileModified\",  \"DmpFileWritten\": \"FileModified\",  \"DmgFileWritten\": \"FileModified\",  \"DirectoryCreate\": \"FolderCreated\",  \"CriticalFileModified\": \"FileModified\",  \"CriticalFileAccessed\": \"FileAccessed\",  \"CabFileWritten\": \"FileModified\",  \"BZip2FileWritten\": \"FileModified\",  \"BmpFileWritten\": \"FileModified\",  \"BlfFileWritten\": \"FileModified\",  \"AsepFileChange\": \"FileModified\",  \"ArjFileWritten\": \"FileModified\",  \"ArcFileWritten\": \"FileModified\"}');\r\n    let EventSeverityLookup = parse_json('{\"SuspiciousPeFileWritten\": \"Medium\",\"SuspiciousEseFileWritten\": \"Medium\",\"RansomwareRenameFile\": \"High\",\"RansomwareOpenFile\": \"High\",\"RansomwareFileAccessPattern\": \"High\",\"RansomwareCreateFile\": \"High\",\"CriticalFileModified\": \"Medium\",\"CriticalFileAccessed\": \"Medium\"}');\r\n    let EventResultStatusLookup = parse_json('{0: {\"EventResultDetails\": \"\",\"EventResult\": \"Success\"},538181633: {\"EventResultDetails\": \"Component Enabled\",\"EventResult\": \"Success\"},1611530273: {\"EventResultDetails\": \"Mask Adjusted\",\"EventResult\": \"Success\"},1611726866: {\"EventResultDetails\": \"DEP disabled appcompat\",\"EventResult\": \"Success\"},1611792386: {\"EventResultDetails\": \"No existing credentials\",\"EventResult\": \"Failure\"},1611923478: {\"EventResultDetails\": \"Component Stopped\",\"EventResult\": \"Success\"},1612251168: {\"EventResultDetails\": \"HTTP Visibility enabled\",\"EventResult\": \"Success\"},3221225506: {\"EventResultDetails\": \"Access Denied\",\"EventResult\": \"Failure\"},3221225533: {\"EventResultDetails\": \"Data late error\",\"EventResult\": \"Failure\"},3221225541: {\"EventResultDetails\": \"Invalid page protection\",\"EventResult\": \"Failure\"},3221226347: {\"EventResultDetails\": \"Driver blocked critical\",\"EventResult\": \"Failure\"},3759013928: {\"EventResultDetails\": \"Process Critical\",\"EventResult\": \"Failure\"},3759013929: {\"EventResultDetails\": \"Process Whitelisted\",\"EventResult\": \"Success\"},3759013930: {\"EventResultDetails\": \"Process Microsoft signed\",\"EventResult\": \"Success\"},3759013931: {\"EventResultDetails\": \"Process Apple signed\",\"EventResult\": \"Success\"},3759407166: {\"EventResultDetails\": \"Component Disabled\",\"EventResult\": \"Failure\"}}');\r\n    let EventResultFileWrittenLookup = parse_json('{0: {\"EventResultDetails\": \"\",\"EventResult\": \"Success\"},1: {\"EventResultDetails\": \"Hash failed\",\"EventResult\": \"Failure\"},2: {\"EventResultDetails\": \"Hash aborted too large\",\"EventResult\": \"Failure\"}}');\r\n    let EventTypeFileLookup = parse_json('{0: \"FileRenamed\",1: \"FileModified\",2: \"FileDeleted\"}');\r\n    let EventTypeSystemOperationLookup = parse_json('{1: \"FileRenamed\",2: \"FileDeleted\"}');source\r\n    | extend eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01')),\r\n             contextDatetime = datetime_add('MilliSecond', tolong(todouble(ContextTimeStamp) * 1000), todatetime('1970-01-01'))\r\n    | extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n    | project-rename\r\n        DvcIpAddr = aip,\r\n        DvcId = aid,\r\n        ActorUsername = UserName,\r\n        EventOriginalType = name,\r\n        EventOriginalUid = id,\r\n        EventProductVersion = ConfigBuild,\r\n        ActingProcessId = ContextProcessId,\r\n        TargetFilePath = TargetFileName,\r\n        SrcFileName = SourceFileName,\r\n        TargetFileDirectory = TargetDirectoryName,\r\n        ActingProcessCommandLine = CommandLine\r\n    | extend \r\n        DvcOs = case(event_platform == \"Win\", \"Windows\", \r\n                    event_platform == \"Mac\", \"Macintosh\",\r\n                    event_platform == \"Lin\", \"Linux\", \r\n                    \"\"),    \r\n        ActorUserId = iff(isnotempty(FileOperatorSid), FileOperatorSid, UID),\r\n        EventStartTime = iff(isnotempty(contextDatetime),contextDatetime,TimeGenerated),\r\n        TargetFileSize = tolong(Size),\r\n        TargetFilePathSplit = iff(event_platform == \"Win\" and ImageFileName == \"\", \r\n                                    split(TargetFilePath,'\\\\'),\r\n                                    split(ImageFileName,'\\\\')\r\n                                ),\r\n        TargetFileSHA256 = SHA256HashData\r\n    | extend EventEndTime = EventStartTime,\r\n            TargetFileName = tostring(TargetFilePathSplit[array_length(TargetFilePathSplit)-1]),\r\n            EventSeverity = tostring(EventSeverityLookup[event_simpleName]),\r\n            EventResultStatus = tostring(EventResultStatusLookup[Status].EventResult),\r\n            EventResultDetailsStatus = tostring(EventResultStatusLookup[Status].EventResultDetails),\r\n            EventResultFileWritten = tostring(EventResultFileWrittenLookup[FileWrittenFlags].EventResult),\r\n            EventResultDetailsFileWritten = tostring(EventResultFileWrittenLookup[FileWrittenFlags].EventResultDetails),\r\n            EventTypeSimple = tostring(EventTypeSimpleNameLookup[event_simpleName]),\r\n            EventTypeFile = tostring(EventTypeFileLookup[FileEventType]),\r\n            EventTypeSystemOperation = tostring(EventTypeSystemOperationLookup[FileSystemOperationType]),\r\n            ActorUsername = case(isnotempty(ActorUsername), ActorUsername,\r\n                                ActorUserId == \"S-1-5-18\", \"Local System\",\r\n                                ActorUserId == \"S-1-0-0\", \"Nobody\",\r\n                                \"\")\r\n    | extend \r\n            AdditionalFields = todynamic(AdditionalFields),\r\n            TargetFileExtension = tostring(split(TargetFileName,\".\",1)[0]),\r\n            TargetFilePathType = iff(DvcOs == \"Windows\", \"Windows Share\",\"\"),\r\n            ActorUsernameType = iff(ActorUsername == \"\",\"\",\"Simple\"),\r\n            ActorUserIdType = case(FileOperatorSid != \"\",\"SID\",\r\n                                   UID != \"\",\"RID\",\r\n                                   \"\"),\r\n            HashType = iff(TargetFileSHA256 == \"\", \"\", \"SHA256\"),\r\n            EventType = case(isnotempty(EventTypeSystemOperation), EventTypeSystemOperation,\r\n                            isnotempty(EventTypeFile), EventTypeFile,\r\n                            EventTypeSimple),\r\n            TargetFileCreationTime = iff(event_simpleName in~ (\"RansomwareCreateFile\", \"PeFileWritten\", \"NewScriptWritten\", \"NewExecutableWritten\"), EventStartTime, todatetime(\"\")),\r\n            EventCount = toint(1),\r\n            EventSchemaVersion = \"0.2.1\",\r\n            EventVendor = \"CrowdStrike\",\r\n            EventProduct = \"Falcon Data Replicator\",\r\n            EventResult = case(isnotempty(EventResultStatus), EventResultStatus,\r\n                               isnotempty(EventResultFileWritten), EventResultFileWritten,\r\n                               \"Success\"),\r\n            EventResultDetails = case(isnotempty(EventResultDetailsStatus), EventResultDetailsStatus,\r\n                                    isnotempty(EventResultDetailsFileWritten), EventResultDetailsFileWritten,\r\n                                    \"\"),\r\n            EventSeverity = iff(EventSeverity == \"\", \"Informational\", EventSeverity)",
            "outputStream": "[concat('Custom-', variables('norm-table-csfile'))]"
          },
          {
            "streams": [
              "Custom-CrowdstrikeAudit"
            ],
            "destinations": [ "myworkspace" ],
            "transformKql": "let EventResultLookup = parse_json('{\"VolumeSnapshotDeleted\": {\"EventType\": \"Delete\",\"Operation\": \"Volume Snapshot Deleted\",\"ObjectType\": \"Others\"},\"VolumeSnapshotCreated\": {\"EventType\": \"Create\",\"Operation\": \"Volume Snapshot Created\",\"ObjectType\": \"File\"},\"SmbServerShareOpenedEtw\": {\"EventType\": \"Set\",\"Operation\": \"SMB Server Share Opened Etw\",\"ObjectType\": \"Others\"},\"SmbClientShareOpenedEtw\": {\"EventType\": \"Set\",\"Operation\": \"SMB Client Share Opened Etw\",\"ObjectType\": \"Others\"},\"SmbClientShareClosedEtw\": {\"EventType\": \"Set\",\"Operation\": \"SMB Client Share Closed Etw\",\"ObjectType\": \"Others\"},\"ProvisioningStarted\": {\"EventType\": \"Start\",\"Operation\": \"Provisioning Started\",\"ObjectType\": \"Others\"},\"ProvisioningEnded\": {\"EventType\": \"Stop\",\"Operation\": \"Provisioning Ended\",\"ObjectType\": \"Others\"},\"OsfmDownloadComplete\": {\"EventType\": \"Others\",\"Operation\": \"Osfm Download Complete\",\"ObjectType\": \"File\"},\"NetShareSecurityModify\": {\"EventType\": \"Set\",\"Operation\": \"NetShare Security Modify\",\"ObjectType\": \"Others\"},\"NetShareDelete\": {\"EventType\": \"Delete\",\"Operation\": \"NetShare Delete\",\"ObjectType\": \"Others\"},\"NetShareAdd\": {\"EventType\": \"Create\",\"Operation\": \"NetShare Add\",\"ObjectType\": \"Others\"},\"MemoryScanEnabled\": {\"EventType\": \"Enable\",\"Operation\": \"Memory Scan Enabled\",\"ObjectType\": \"Others\"},\"ManifestDownloadComplete\": {\"EventType\": \"Others\",\"Operation\": \"Manifest Download Complete\",\"ObjectType\": \"File\"},\"LfoUploadStart\": {\"EventType\": \"Start\",\"Operation\": \"LFO Upload Start\",\"ObjectType\": \"Others\"},\"IoSessionConnected\": {\"EventType\": \"Others\",\"Operation\": \"IO Session Connected\",\"ObjectType\": \"Others\"},\"InstallServiceDownloadComplete\": {\"EventType\": \"Install\",\"Operation\": \"Install Service Download Complete\",\"ObjectType\": \"File\"},\"InstallBundleDownloadComplete\": {\"EventType\": \"Install\",\"Operation\": \"Install Bundle Download Complete\",\"ObjectType\": \"File\"},\"HostnameChanged\": {\"EventType\": \"Set\",\"Operation\": \"Hostname Changed\",\"ObjectType\": \"Host\"},\"FirewallSetRule\": {\"EventType\": \"Set\",\"Operation\": \"Firewall Set Rule\",\"ObjectType\": \"Policy Rule\"},\"FirewallEnabled\": {\"EventType\": \"Enable\",\"Operation\": \"Firewall Enabled\",\"ObjectType\": \"Others\"},\"FirewallDisabled\": {\"EventType\": \"Disable\",\"Operation\": \"Firewall Disabled\",\"ObjectType\": \"Others\"},\"FirewallDeleteRule\": {\"EventType\": \"Delete\",\"Operation\": \"Firewall Delete Rule\",\"ObjectType\": \"Policy Rule\"},\"FirewallChangeOption\": {\"EventType\": \"Set\",\"Operation\": \"Firewall Change Option\",\"ObjectType\": \"Others\"},\"FileVaultStatus\": {\"EventType\": \"Set\",\"Operation\": \"File Vault Status\",\"ObjectType\": \"Others\"},\"FileRenameInfo\": {\"EventType\": \"Set\",\"Operation\": \"File Rename\",\"ObjectType\": \"File\"},\"FileOpenInfo\": {\"EventType\": \"Others\",\"Operation\": \"File Open\",\"ObjectType\": \"File\"},\"FileDeleteInfo\": {\"EventType\": \"Delete\",\"Operation\": \"File Delete\",\"ObjectType\": \"File\"},\"FileCreateInfo\": {\"EventType\": \"Create\",\"Operation\": \"File Create\",\"ObjectType\": \"File\"},\"EventLogCleared\": {\"EventType\": \"Others\",\"Operation\": \"Event Logs Cleared\",\"ObjectType\": \"File\"},\"DcUsbDeviceWhitelisted\": {\"EventType\": \"Others\",\"Operation\": \"DC USB Device Whitelisted\",\"ObjectType\": \"Others\"},\"DcUsbDeviceDisconnected\": {\"EventType\": \"Others\",\"Operation\": \"DC USB Device Disconnected\",\"ObjectType\": \"Others\"},\"DcBluetoothDeviceDisconnected\": {\"EventType\": \"Others\",\"Operation\": \"DC Bluetooth Device Disconnected\",\"ObjectType\": \"Others\"},\"DcBluetoothDeviceConnected\": {\"EventType\": \"Others\",\"Operation\": \"DC Bluetooth Device Connected\",\"ObjectType\": \"Others\"},\"CriticalEnvironmentVariableChanged\": {\"EventType\": \"Set\",\"Operation\": \"Critical Environment Variable Changed\",\"ObjectType\": \"Others\"},\"ConfigStateUpdate\": {\"EventType\": \"Set\",\"Operation\": \"Config State Update\",\"ObjectType\": \"Configuration\"},\"ActiveDirectoryAccountUnlocked\": {\"EventType\": \"Others\",\"Operation\": \"Active Directory Account Unlocked\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountPasswordUpdate\": {\"EventType\": \"Set\",\"Operation\": \"Active Directory Account Password Update\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountOuUpdate\": {\"EventType\": \"Set\",\"Operation\": \"Active Directory Account Ou Update\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountNameUpdate\": {\"EventType\": \"Set\",\"Operation\": \"Active Directory Account Name Update\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountLocked\": {\"EventType\": \"Others\",\"Operation\": \"Active Directory Account Locked\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountEnabled\": {\"EventType\": \"Enable\",\"Operation\": \"Active Directory Account Enabled\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountDisabled\": {\"EventType\": \"Disable\",\"Operation\": \"Active Directory Account Disabled\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountDepartmentUpdate\": {\"EventType\": \"Set\",\"Operation\": \"Active Directory Account Department Update\",\"ObjectType\": \"Account\"},\"ActiveDirectoryAccountCreated\": {\"EventType\": \"Create\",\"Operation\": \"Active Directory Account Created\",\"ObjectType\": \"Account\"},\"IOServiceRegister\": {\"EventType\": \"Others\",\"Operation\": \"IO Service Register\",\"ObjectType\": \"Others\"}}');\r\n    source\r\n        | extend eventDatetime = datetime_add('Millisecond', tolong(timestamp), todatetime('1970-01-01')),\r\n                 contextDatetime = datetime_add('MilliSecond', tolong(todouble(ContextTimeStamp) * 1000), todatetime('1970-01-01'))\r\n        | extend TimeGenerated = iff(isnotempty(eventDatetime), eventDatetime, now())\r\n        | project-rename\r\n            DvcIpAddr = aip,\r\n            DvcId = aid,\r\n            ActorUsername = UserName,\r\n            EventOriginalType = name,\r\n            EventOriginalUid = id,\r\n            EventProductVersion = ConfigBuild\r\n        | extend \r\n            DvcOs = case(event_platform == \"Win\", \"Windows\", \r\n                        event_platform == \"Mac\", \"Macintosh\",\r\n                        event_platform == \"Lin\", \"Linux\", \r\n                        \"\"),\r\n            ActorUsernameType = iff(isnotempty(ActorUsername),\"Simple\",\"\"),\r\n            EventStartTime = iff(isnotempty(contextDatetime),contextDatetime,TimeGenerated)\r\n        | extend \r\n                Operation = tostring(EventResultLookup[event_simpleName].Operation),\r\n                Object = case(\r\n                              event_simpleName =~ \"VolumeSnapshotDeleted\", VolumeSnapshotName,\r\n                              event_simpleName =~ \"VolumeSnapshotCreated\", TargetFileName,\r\n                              event_simpleName startswith \"Smb\", SmbShareName,\r\n                              event_simpleName startswith \"Provisioning\", \"Agent\",\r\n                              event_simpleName =~ \"OsfmDownloadComplete\", TargetFileName,\r\n                              event_simpleName startswith \"NetShare\", ShareName,\r\n                              event_simpleName =~ \"MemoryScanEnabled\", \"Memory Scan\",\r\n                              event_simpleName =~ \"ManifestDownloadComplete\", TargetFileName,\r\n                              event_simpleName =~ \"LfoUploadStart\", UploadId,\r\n                              event_simpleName =~ \"IoSessionConnected\", SessionId,\r\n                              event_simpleName =~ \"IOServiceRegister\", IOServiceName,\r\n                              event_simpleName startswith \"Install\", TargetFileName,\r\n                              event_simpleName =~ \"HostnameChanged\", ComputerName,\r\n                              event_simpleName =~ \"FirewallSetRule\", iff(isnotempty(FirewallRule),strcat(FirewallRule,'\\\\',FirewallRuleId),FirewallRuleId),\r\n                              event_simpleName in~ (\"FirewallEnabled\",\"FirewallDisabled\"), \"Firewall\",\r\n                              event_simpleName =~ \"FirewallDeleteRule\", FirewallRuleId,\r\n                              event_simpleName =~ \"FirewallChangeOption\", FirewallOption,\r\n                              event_simpleName =~ \"FileVaultStatus\", \"File Vault\",\r\n                              event_simpleName =~ \"FileRenameInfo\", SourceFileName,\r\n                              event_simpleName startswith \"File\", TargetFileName,\r\n                              event_simpleName =~ \"EventLogCleared\", TargetFileName,\r\n                              event_simpleName =~ \"DcUsbDeviceWhitelisted\", iff(isnotempty(DeviceVendorId),strcat(DeviceVendorId,'\\\\',DeviceProductId),DeviceProductId),\r\n                              event_simpleName =~ \"DcUsbDeviceDisconnected\", DeviceSerialNumber,\r\n                              event_simpleName startswith \"DcBluetoothDevice\", BluetoothDeviceAddress,\r\n                              event_simpleName =~ \"CriticalEnvironmentVariableChanged\", EnvironmentVariableName,\r\n                              event_simpleName =~ \"ConfigStateUpdate\", \"Config State\",\r\n                              event_simpleName startswith \"ActiveDirectoryAccount\", SamAccountName,  \r\n                              \"\"),\r\n                ObjectType = tostring(EventResultLookup[event_simpleName].ObjectType),\r\n                OldValue = case(\r\n                              event_simpleName == \"FileRenameInfo\", SourceFileName, \r\n                              \"\"),\r\n                NewValue = case(\r\n                              event_simpleName == \"FirewallChangeOption\", iff(isnotempty(FirewallOptionNumericValue),FirewallOptionNumericValue,FirewallOptionStringValue), \r\n                              event_simpleName == \"FileVaultStatus\", FileVaultIsEnabled,\r\n                              event_simpleName == \"FileRenameInfo\", TargetFileName,\r\n                              event_simpleName == \"CriticalEnvironmentVariableChanged\", EnvironmentVariableName,\r\n                              event_simpleName == \"ConfigStateUpdate\", ConfigStateData,\r\n                              event_simpleName == \"ActiveDirectoryAccountOuUpdate\", ActiveDirectoryOuDn,\r\n                              event_simpleName == \"ActiveDirectoryAccountDepartmentUpdate\", ActiveDirectoryDepartment,\r\n                              \"\"),\r\n                EventEndTime = EventStartTime,\r\n                EventType = tostring(EventResultLookup[event_simpleName].EventResult),\r\n                EventCount = toint(1),\r\n                EventSchemaVersion = \"0.1.0\",\r\n                EventVendor = \"CrowdStrike\",\r\n                EventProduct = \"Falcon Data Replicator\",\r\n                EventResult = \"Success\",\r\n                EventSeverity = \"Informational\"",
            "outputStream": "Microsoft-ASimAuditEventLogs"
          },
        ]
      },
      "condition": "[variables('dcr-normalized-data_refresh_flag')]"
    }
  ],
  "outputs": {}
}
